{% extends "base.html" %}
{% block content %}

<div class="container mx-auto px-4 py-6">

    <!-- TÍTULO -->
    <h1 class="text-3xl font-bold mb-6">Estoque e Reposição</h1>

    <!-- CARDS RESUMO -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

        <!-- Total unidades -->
        <div class="stat bg-white rounded shadow p-4">
            <div class="stat-title">Total de Unidades em Estoque</div>
            <div class="stat-value">{{ total_unidades_estoque|int }}</div>
        </div>

        <!-- Custo total -->
        <div class="stat bg-white rounded shadow p-4">
            <div class="stat-title">Custo Total do Estoque</div>
            <div class="stat-value">R$ {{ '%.2f'|format(total_custo_estoque or 0) }}</div>
        </div>

        <!-- LUCRO POTENCIAL DO ESTOQUE (NOVO) -->
        <div class="stat bg-white rounded shadow p-4 bg-green-50 border border-green-300">
            <div class="stat-title font-bold text-green-700">
                Receita Potencial do Estoque (Lucro Líquido Esperado)
            </div>
            <div class="stat-value text-green-700">
                R$ {{ '%.2f'|format(lucro_potencial_total or 0) }}
            </div>
            <div class="stat-desc text-sm text-green-600 mt-2">
                Baseado no desempenho histórico real de vendas.
            </div>
        </div>

    </div>

    <!-- TABELA DE PRODUTOS -->
    <div class="overflow-x-auto">
        <table class="table table-zebra w-full text-sm">

            <thead>
                <tr class="bg-gray-200">
                    <th>Produto</th>
                    <th>SKU</th>
                    <th>Estoque atual</th>
                    <th>Custo unitário (R$)</th>
                    <th>Custo total (R$)</th>

                    <th>Média diária</th>
                    <th>Média mensal</th>
                    <th>Dias de cobertura</th>

                    <!-- NOVO -->
                    <th>Lucro potencial (R$)</th>
                    <th>Retorno (%)</th>

                    <th>Situação</th>
                </tr>
            </thead>

            <tbody>
                {% for p in produtos %}
                <tr>

                    <td>{{ p.nome }}</td>
                    <td>{{ p.sku }}</td>
                    <td>{{ p.estoque_atual|int }}</td>

                    <td>R$ {{ '%.2f'|format(p.custo_unitario) }}</td>
                    <td>R$ {{ '%.2f'|format(p.custo_estoque) }}</td>

                    <td>{{ '%.2f'|format(p.media_diaria) }}</td>
                    <td>{{ '%.2f'|format(p.media_mensal) }}</td>

                    <td>
                        {% if p.dias_cobertura %}
                            {{ '%.0f'|format(p.dias_cobertura) }} dias
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    <!-- LUCRO POTENCIAL -->
                    <td class="font-semibold text-green-700">
                        R$ {{ '%.2f'|format(p.lucro_potencial or 0) }}
                    </td>

                    <!-- RETORNO % -->
                    <td class="font-semibold text-blue-700">
                        {{ '%.2f'|format(p.retorno_percent or 0) }}%
                    </td>

                    <!-- SITUAÇÃO -->
                    <td>
                        {% if p.precisa_repor %}
                            <span class="badge badge-warning">Repor</span>
                        {% else %}
                            <span class="badge badge-success">OK</span>
                        {% endif %}
                    </td>

                </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

</div>

{% endblock %}
