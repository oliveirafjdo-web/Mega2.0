{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

    <!-- =========================== -->
    <!-- TOTAIS NO TOPO -->
    <!-- =========================== -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center p-3">
                <h5>Total de Vendas</h5>
                <h3>{{ totais.qtd }}</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center p-3">
                <h5>Faturamento Total</h5>
                <h3>R$ {{ "%.2f"|format(totais.receita or 0) }}</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center p-3">
                <h5>Custo Total</h5>
                <h3>R$ {{ "%.2f"|format(totais.custo or 0) }}</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center p-3">
                <h5>Lucro Total</h5>
                <h3>
                    R$ {{ "%.2f"|format((totais.receita or 0) - (totais.custo or 0)) }}
                </h3>
            </div>
        </div>
    </div>

    <!-- =========================== -->
    <!-- LINHA 1: FATURAMENTO x QUANTIDADE -->
    <!-- =========================== -->
    <div class="row">
        <!-- Faturamento diário -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-body">
                    <h3 class="card-title">Faturamento diário</h3>
                    <canvas id="chartFaturamento" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Quantidade vendida por dia -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-body">
                    <h3 class="card-title">Quantidade vendida por dia</h3>
                    <canvas id="chartQuantidade" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- =========================== -->
    <!-- LINHA 2: LUCRO x COMPARATIVO -->
    <!-- =========================== -->
    <div class="row">
        <!-- Lucro diário -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-body">
                    <h3 class="card-title">Lucro diário</h3>
                    <canvas id="chartLucro" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Comparativo: mês atual x mês anterior -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-body">
                    <h3 class="card-title">Comparativo: Mês atual x Mês anterior</h3>
                    <canvas id="chartComparativo" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- =========================== -->
<!-- SCRIPTS DOS GRÁFICOS -->
<!-- =========================== -->

<!-- Se o Chart.js já estiver no base.html, pode remover esta linha -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Dados vindos do Flask
    const labels = {{ grafico_labels|tojson|safe }};
    const dadosFaturamento = {{ grafico_faturamento|tojson|safe }};
    const dadosQuantidade = {{ grafico_quantidade|tojson|safe }};
    const dadosLucro = {{ grafico_lucro|tojson|safe }};

    const labelsCmp = {{ grafico_cmp_labels|tojson|safe }};
    const dadosAtual = {{ grafico_cmp_atual|tojson|safe }};
    const dadosAnterior = {{ grafico_cmp_anterior|tojson|safe }};

    // ========================================
    // GRÁFICO 1 — FATURAMENTO DIÁRIO (Linha + Área)
    // ========================================
    new Chart(document.getElementById('chartFaturamento'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: "Faturamento (R$)",
                data: dadosFaturamento,
                borderColor: "#3498db",
                backgroundColor: "rgba(52,152,219,0.3)",
                fill: true,
                tension: 0.3,
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { ticks: { maxRotation: 45, minRotation: 45 }},
                y: { beginAtZero: true }
            }
        }
    });

    // ========================================
    // GRÁFICO 2 — QUANTIDADE POR DIA (Barras Azuis)
    // ========================================
    new Chart(document.getElementById('chartQuantidade'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: "Quantidade vendida",
                data: dadosQuantidade,
                backgroundColor: "#1E90FF",
                borderColor: "#1E90FF",
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { ticks: { maxRotation: 45, minRotation: 45 }},
                y: { beginAtZero: true }
            }
        }
    });

    // ========================================
    // GRÁFICO 3 — LUCRO DIÁRIO (Linha Verde + Área)
    // ========================================
    new Chart(document.getElementById('chartLucro'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: "Lucro (R$)",
                data: dadosLucro,
                borderColor: "#2ecc71",
                backgroundColor: "rgba(46,204,113,0.3)",
                fill: true,
                tension: 0.3,
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { ticks: { maxRotation: 45, minRotation: 45 }},
                y: { beginAtZero: true }
            }
        }
    });

    // ========================================
    // GRÁFICO 4 — COMPARATIVO MÊS ATUAL X ANTERIOR
    // ========================================
    new Chart(document.getElementById('chartComparativo'), {
        type: "line",
        data: {
            labels: labelsCmp,
            datasets: [
                {
                    label: "Mês atual",
                    data: dadosAtual,
                    borderColor: "rgba(52,152,219,0.8)",
                    backgroundColor: "rgba(52,152,219,0.2)",
                    fill: true,
                    tension: 0.3,
                    pointRadius: 3
                },
                {
                    label: "Mês anterior",
                    data: dadosAnterior,
                    borderColor: "rgba(155,89,182,0.8)",
                    backgroundColor: "rgba(155,89,182,0.2)",
                    fill: true,
                    tension: 0.3,
                    pointRadius: 3
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                x: { ticks: { maxRotation: 45, minRotation: 45 }},
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}
