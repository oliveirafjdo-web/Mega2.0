{% extends "base.html" %}
{% block content %}
<h1>Relatório de Lucro</h1>

<div class="filter-card">
  <div class="filter-card-header">Filtro por data</div>

  <form method="get">
    <div class="filter-row">

      <div class="filter-field">
        <label>Data início</label>
        <input type="date" name="data_inicio" value="{{ data_inicio }}">
      </div>

      <div class="filter-field">
        <label>Data fim</label>
        <input type="date" name="data_fim" value="{{ data_fim }}">
      </div>

      <div class="filter-actions">
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{{ url_for('relatorio_lucro') }}" class="btn btn-link">Limpar</a>
      </div>

      <div style="margin-left:auto;">
        <span class="small">
          Imposto: {{ '%.2f'|format(imposto_percent) }}% |
          Despesas: {{ '%.2f'|format(despesas_percent) }}%
        </span>
      </div>

    </div>
  </form>
</div>

<table>
  <thead>
    <tr>
      <th>Produto</th>
      <th>Qtd</th>
      <th>Receita Bruta</th>
      <th>Custo</th>
      <th>Comissão ML (est.)</th>
      <th>Imposto</th>
      <th>Despesas</th>
      <th>Lucro Líquido</th>
    </tr>
  </thead>
  <tbody>
    {% for l in linhas %}
    <tr>
      <td>{{ l.produto }}</td>
      <td>{{ '%.0f'|format(l.qtd) }}</td>
      <td>R$ {{ '%.2f'|format(l.receita) }}</td>
      <td>R$ {{ '%.2f'|format(l.custo) }}</td>
      <td>R$ {{ '%.2f'|format(l.comissao) }}</td>
      <td>R$ {{ '%.2f'|format(l.imposto) }}</td>
      <td>R$ {{ '%.2f'|format(l.despesas) }}</td>
      <td>R$ {{ '%.2f'|format(l.margem_liquida) }}</td>
    </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr style="background:#eef; font-weight:bold;">
      <td>Total</td>
      <td>{{ '%.0f'|format(totais.qtd) }}</td>
      <td>R$ {{ '%.2f'|format(totais.receita) }}</td>
      <td>R$ {{ '%.2f'|format(totais.custo) }}</td>
      <td>R$ {{ '%.2f'|format(totais.comissao) }}</td>
      <td>R$ {{ '%.2f'|format(totais.imposto) }}</td>
      <td>R$ {{ '%.2f'|format(totais.despesas) }}</td>
      <td>R$ {{ '%.2f'|format(totais.margem_liquida) }}</td>
    </tr>
  </tfoot>
</table>
{% endblock %}
