{% extends "base.html" %}
{% block content %}
<h1>Relatório de lucro por produto</h1>

<p class="small">
  Margem líquida = Receita - Comissão ML - Custo - Despesas - Imposto.
  {% if imposto_percent or despesas_percent %}
    Imposto: {{ '%.2f'|format(imposto_percent or 0) }}%% ·
    Despesas: {{ '%.2f'|format(despesas_percent or 0) }}%%
  {% endif %}
</p>

<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th>Produto</th>
      <th class="text-end">Qtd. vendida</th>
      <th class="text-end">Receita (R$)</th>
      <th class="text-end">Custo prod. (R$)</th>
      <th class="text-end">Comissão ML (R$)</th>
      <th class="text-end">Imposto (R$)</th>
      <th class="text-end">Despesas (R$)</th>
      <th class="text-end">Margem líquida (R$)</th>
      <th class="text-end">Margem líquida (%)</th>
    </tr>
  </thead>
  <tbody>
    {% for l in linhas %}
    <tr>
      <td>{{ l.produto }}</td>
      <td class="text-end">{{ l.qtd|int }}</td>
      <td class="text-end">{{ '%.2f'|format(l.receita or 0) }}</td>
      <td class="text-end">{{ '%.2f'|format(l.custo or 0) }}</td>
      <td class="text-end">{{ '%.2f'|format(l.comissao or 0) }}</td>
      <td class="text-end">{{ '%.2f'|format(l.imposto or 0) }}</td>
      <td class="text-end">{{ '%.2f'|format(l.despesas or 0) }}</td>
      <td class="text-end">{{ '%.2f'|format(l.margem_liquida or 0) }}</td>
      <td class="text-end">
        {% if l.receita %}
          {{ '%.2f'|format((l.margem_liquida / l.receita) * 100) }}%%
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <th>Totais</th>
      <th class="text-end">{{ totais.qtd|int }}</th>
      <th class="text-end">{{ '%.2f'|format(totais.receita or 0) }}</th>
      <th class="text-end">{{ '%.2f'|format(totais.custo or 0) }}</th>
      <th class="text-end">{{ '%.2f'|format(totais.comissao or 0) }}</th>
      <th class="text-end">{{ '%.2f'|format(totais.imposto or 0) }}</th>
      <th class="text-end">{{ '%.2f'|format(totais.despesas or 0) }}</th>
      <th class="text-end">{{ '%.2f'|format(totais.margem_liquida or 0) }}</th>
      <th class="text-end">
        {% if totais.receita %}
          {{ '%.2f'|format((totais.margem_liquida / totais.receita) * 100) }}%%
        {% else %}
          -
        {% endif %}
      </th>
    </tr>
  </tfoot>
</table>
{% endblock %}
