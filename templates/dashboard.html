{% extends "base.html" %}

{% block title %}Dashboard • MetriFy{% endblock %}
{% block page_icon %}<i class="bi bi-speedometer text-primary"></i>{% endblock %}
{% block page_title %}Dashboard Financeiro{% endblock %}

{% block content %}
<div class="row g-3 mb-3">
  <!-- Receita bruta -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-cash-coin text-success"></i>
          Receita Bruta
        </div>
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(receita_total) }}</div>
      <div class="stat-sub">Total faturado (todas as vendas)</div>
    </div>
  </div>

  <!-- Receita líquida -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-cash-stack text-info"></i>
          Receita Líquida
        </div>
        <span class="badge-soft">Após taxas, imposto e despesas</span>
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(receita_liquida_total) }}</div>
      <div class="stat-sub">Receita - comissão - impostos - despesas</div>
    </div>
  </div>

  <!-- Lucro líquido -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-graph-up-arrow text-success"></i>
          Lucro Líquido
        </div>
        <span class="badge-soft">Tem que bater com o relatório</span>
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(lucro_liquido_total) }}</div>
      <div class="stat-sub">Já descontando custo, taxas, impostos e despesas</div>
    </div>
  </div>

  <!-- Margem líquida -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-percent text-warning"></i>
          Margem Líquida
        </div>
      </div>
      <div class="stat-value">{{ '%.2f'|format(margem_liquida_percent) }}%</div>
      <div class="stat-sub">Lucro líquido sobre a receita bruta</div>
    </div>
  </div>
</div>

<div class="row g-3 mb-3">
  <!-- Custo de produtos -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-box-seam text-secondary"></i>
          Custo de Produtos
        </div>
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(custo_total) }}</div>
      <div class="stat-sub">Soma dos custos de todos os produtos vendidos</div>
    </div>
  </div>

  <!-- Comissão ML -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-shop text-danger"></i>
          Comissão Mercado Livre
        </div>
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(comissao_total) }}</div>
      <div class="stat-sub">Estimado a partir da planilha (tarifa de venda e impostos)</div>
    </div>
  </div>

  <!-- Impostos -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-receipt-cutoff text-warning"></i>
          Impostos
        </div>
        {% if cfg %}
          <span class="badge-soft">{{ '%.2f'|format(cfg.imposto_percent) }}% sobre a receita</span>
        {% endif %}
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(imposto_total) }}</div>
      <div class="stat-sub">Baseado no % definido em Configurações</div>
    </div>
  </div>

  <!-- Despesas -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-credit-card-2-back text-info"></i>
          Outras Despesas
        </div>
        {% if cfg %}
          <span class="badge-soft">{{ '%.2f'|format(cfg.despesas_percent) }}% sobre a receita</span>
        {% endif %}
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(despesas_total) }}</div>
      <div class="stat-sub">Frete, operação, estrutura, etc.</div>
    </div>
  </div>
</div>

<div class="row g-3 mb-3">
  <!-- Ticket médio -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-ticket-perforated text-info"></i>
          Ticket Médio
        </div>
      </div>
      <div class="stat-value">R$ {{ '%.2f'|format(ticket_medio) }}</div>
      <div class="stat-sub">Valor médio por venda</div>
    </div>
  </div>

  <!-- Margem média de contribuição -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-pie-chart text-primary"></i>
          Margem de Contribuição
        </div>
      </div>
      <div class="stat-value">{{ '%.2f'|format(margem_media) }}%</div>
      <div class="stat-sub">Média da margem de contribuição sobre a receita</div>
    </div>
  </div>

  <!-- Produtos -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-boxes text-light"></i>
          Produtos Cadastrados
        </div>
      </div>
      <div class="stat-value">{{ total_produtos }}</div>
      <div class="stat-sub">Itens únicos no catálogo</div>
    </div>
  </div>

  <!-- Estoque -->
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-stack text-success"></i>
          Estoque Atual
        </div>
      </div>
      <div class="stat-value">{{ estoque_total }}</div>
      <div class="stat-sub">Quantidade total disponível</div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-12 col-lg-4">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-trophy text-warning"></i>
          Produto mais vendido
        </div>
      </div>
      {% if produto_mais_vendido %}
        <div class="stat-value" style="font-size:16px;">{{ produto_mais_vendido[0] }}</div>
        <div class="stat-sub">Quantidade vendida: {{ produto_mais_vendido[1] }}</div>
      {% else %}
        <div class="text-soft">Ainda não há vendas cadastradas.</div>
      {% endif %}
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-award text-success"></i>
          Maior lucro (produto)
        </div>
      </div>
      {% if produto_maior_lucro %}
        <div class="stat-value" style="font-size:16px;">{{ produto_maior_lucro[0] }}</div>
        <div class="stat-sub">Lucro acumulado: R$ {{ '%.2f'|format(produto_maior_lucro[1]) }}</div>
      {% else %}
        <div class="text-soft">Ainda não há vendas cadastradas.</div>
      {% endif %}
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card-glass">
      <div class="card-glass-header">
        <div class="card-glass-title">
          <i class="bi bi-emoji-frown text-danger"></i>
          Pior desempenho de margem
        </div>
      </div>
      {% if produto_pior_margem %}
        <div class="stat-value" style="font-size:16px;">{{ produto_pior_margem[0] }}</div>
        <div class="stat-sub">Margem acumulada: R$ {{ '%.2f'|format(produto_pior_margem[1]) }}</div>
      {% else %}
        <div class="text-soft">Ainda não há vendas cadastradas.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
