{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3>Importar Mercado Pago</h3>

  {% if msg %}
    <div class="alert alert-info">{{ msg }}</div>
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="mb-4">
    <div class="mb-2">
      <input type="file" name="arquivo" accept=".xlsx" class="form-control" required>
    </div>
    <button class="btn btn-primary">Importar</button>
  </form>

  <h5>Importações (lotes)</h5>
  <div class="table-responsive">
    <table class="table table-sm table-striped">
      <thead>
        <tr>
          <th>Criado em</th>
          <th>Lote</th>
          <th>Qtd</th>
          <th>Entradas</th>
          <th>Devoluções</th>
          <th>Retiradas</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody>
        {% for b in batches %}
        <tr>
          <td>{{ b.criado_em or '' }}</td>
          <td>{{ (b.batch_id or '')[:10] }}</td>
          <td>{{ b.qtd }}</td>
          <td>R$ {{ '%.2f'|format(b.entradas or 0) }}</td>
          <td>R$ {{ '%.2f'|format((b.devolucoes or 0) * -1) }}</td>
          <td>R$ {{ '%.2f'|format((b.retiradas or 0) * -1) }}</td>
          <td>
            <form method="post" action="/importar_mp/excluir/{{ b.batch_id }}" onsubmit="return confirm('Excluir este lote?');">
              <button class="btn btn-sm btn-danger">Excluir</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
